<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>谈菁论道</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="swiper.css">
    <link rel="stylesheet" href="animate.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="page-1 page stop-swiping" id="first">
                    <div class="pre-text text-top">
                        <img src="images/toptext1.png" alt="">
                    </div>
                    <div class="after-text text-top">
                        <img src="images/toptext2.png" alt="">
                    </div>
                    <div class="swip-container stop-swiping">
                        <img src="images/lung.png" alt="" id="lung">
                        <img src="images/cancer.png" alt="" id="cancer">
                        <img src="images/hand.png" alt="" class="hand animated flash infinite">
                    </div>
                    <div class="pre-text text-bottom">
                        <img src="images/bottomtext1.png" alt="">
                    </div>
                    <div class="after-text text-bottom">
                        <img src="images/bottomtext2.png" alt="">
                    </div>
                </div>
            </div>

                  <!-- <div class="avatar-content" id="avatarContent">
                  </div> -->
            <!--<div class="swiper-slide">-->
              <!--<div class="page-2 page">-->
                <!--&lt;!&ndash;<img src="images/ava.jpg" alt="" id="avaImg" class="avatar-logo ava-list logo">&ndash;&gt;-->
                <!--<div class="logo-box">-->
                  <!--<img src="images/textlogo.png" class="logo" id="logo">-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->
            <div class="swiper-slide">
                <div class="page-2 page">
                  <img src="images/textlogo.png" class="logo">
                </div>
            </div>
            <div class="swiper-slide">
                <div class="page-4 page">
                  <img src="images/page4text.png" class="logo">
                </div>
            </div>
            <div class="swiper-slide">
                <div class="page-5 page">
                  <img src="images/page5text.png" class="text-top logo">
                  <img src="images/map.png">
                </div>
            </div>
            <div class="swiper-slide">
                <div class="page-6 page">
                  <img src="images/textlogo.png" class="text-top logo">
                  <img src="images/finaltext.png" class="logo">
                </div>
            </div>
        </div>
        <div class="arrow-box">
            <img src="images/arrow.png" id="array">
        </div>
    </div>
    <audio id="audio" preload="true" loop="" autoplay="autoplay"  src="./images/bg.mp3"></audio>
    <audio id="heart" preload="true" loop=""   src="./images/heart.mp3"></audio>
    <div id="music">
      <img class="ico-video fadeRound" src="images/music.png"></span>
    </div>
    <script src="js/swiper.js"></script>
    <script src='js/jquery-2.1.1.min.js' type='text/javascript'></script>
    <script src='js/jquery.eraser.js' type='text/javascript'></script>
    <script type = "text/javascript">

      $(function(){
        var html = '<div class="ori"></div>';
        $('.arrow-box').hide();
        var audio = document.getElementById("audio");
        var heartAudio = document.getElementById("heart");
        audio.load();
        audio.play();
        document.addEventListener("WeixinJSBridgeReady", function () {
            audio.load();
            audio.play();
        }, false);
        $('#music').on('click', function(e) {
          console.log(e.target);
          $('#music img').toggleClass('close');
          console.log($('#music img').hasClass('close'));
          if ($('#music img').hasClass('close')) {
              audio.pause();
          } else {
              audio.play();
          }
        })
        // var userId = getCookie('userid2');
        // alert(userId);
        var api = 'http://minisite.medtoday.com.cn/cycle'
        // if(!userId) {
        //   window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?scope=snsapi_userinfo&appid=wx967511ec58e38c2d&redirect_uri=http%3A%2F%2Fminisite.medtoday.com.cn%2Fcycle%2Fwechat%2Fgetuserinforfortopeasy.php%3Fresourceid%3D8&state=STATE&response_type=code&connect_redirect=1#wechat_redirect';
        // }
        // var objParam = {
        //   user_id: userId
        // };
        // $.getJSON(api + '/wechat/getonewechauserinforbyuserid.php', objParam, function (ret) {
        //     console.log(ret);
        //     // $('#console').html(ret);
        //     var user = ret.user[0].headimgur;
        //     console.log(html)
        //     // html += '<img src=' + user + 'alt="" id="avaImg" class="avatar-logo ava-list" />';
        //     $('#avaImg').attr('src', user);
        //
        // });
        var headList = [];
        // $.getJSON(api + '/wechat/getallwechatuserforgameuser.php', objParam, function (ret) {
        //     if (ret.user.length) {
        //       var userList = ret.user;
        //       userList.forEach(function(val, index) {
        //         if (index < 200) {
        //           if (val.headimgur.length > 5) {
        //             headList.push(val.headimgur);
        //           }
        //         }
        //       })
        //       console.log(headList);
        //       renderAvatar();
        //     }
        // });

        function renderAvatar() {
          // var html = '';
          html += '<div class="avatar-content" id="avatarContent">';
          headList.forEach(function(val) {
            html += '<img class="ava-list" src=' + val + '/>';
          })
          html += '</div>';
          console.log(html);
          // $('#avatarContent').html(html);
        }

        function first() {
          console.log(111);
          $('.arrow-box').hide();
          $('#lung').removeClass('heart');
        }

        function second() {
          $('.logo').removeClass('animated fadeInUp').addClass('animated fadeInUp').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
                    $(this).removeClass('animated fadeInUp');
                  });
          heartAudio.pause();
        }



        var mySwiper = new Swiper ('.swiper-container', {
          direction: 'vertical',
          loop: false,
          noSwipingClass : 'stop-swiping',
          on: {
            slideChangeTransitionStart: function(){
              if (this.activeIndex === 0) {
                first();
              }
              if (this.activeIndex !==0) {
                // document.getElementById("audio").play();
                // if (this.isEnd) return;
                second();
              }
              console.log(this.activeIndex);

              if (this.activeIndex ===4 || this.activeIndex ===0) {
                $('.arrow-box').hide();
              } else {
                $('.arrow-box').show();
              }

            },
          },
        });
        var timer;

        $('#cancer').eraser({
          progressFunction: function(p) {
            console.log(p);
            if (p > 0.02) {
              $('.hand').removeClass('animated flash infinite').addClass('animated fadeOutRight')
              // timer = setTimeout(getProgress, 500);
            }
            if (p > 0.97) {
              $('.pre-text.text-top').addClass('animated fadeOutDown').hide();
              $('.pre-text.text-bottom').addClass('animated fadeOutDown').hide();
              $('.after-text.text-top').show().addClass('animated fadeInDown');
              $('.after-text.text-bottom').show().addClass('animated fadeInUp');
            }
          },
          completeRatio: .5,
          completeFunction: afterEraser
        });

        function afterEraser() {
          $('#cancer').eraser('clear');
          $('#lung').addClass('heart');
          heartAudio.load();
          heartAudio.play();
          document.addEventListener("WeixinJSBridgeReady", function () {
            heartAudio.load();
            heartAudio.play();
          }, false);

          $('.pre-text.text-top').addClass('animated fadeOutDown').hide();
          $('.pre-text.text-bottom').addClass('animated fadeOutDown').hide();
          $('.after-text.text-top').show().addClass('animated fadeInDown');
          $('.after-text.text-bottom').show().addClass('animated fadeInUp');
          $('.arrow-box').show();
          $('#first').removeClass('stop-swiping');
        }

        function getCookie(name){
          var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
          if(arr=document.cookie.match(reg)) {
            return unescape(arr[2]);
          }
          return null;
        }


      });

    </script>
</body>
</html>
